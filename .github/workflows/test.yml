name: Run Makefile and execute output

# on:
#   push:
#     branches: [ "master" ]
#   pull_request:
#     branches: [ "master" ]

# jobs:
#   build:

#     runs-on: ubuntu-latest

#     steps:
#     - uses: actions/checkout@v3
#     - name: configure
#       run: ./configure
#     - name: make
#       run: make
#     - name: make check
#       run: make check
#     - name: make distcheck
#       run: make distcheck

on:
  push:
    branches: ['master']
  pull_request:
    branches: ['master']

jobs:
  build-and-run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Checkout other repo into zmytest
        uses: actions/checkout@v4
        with:
          repository: 'RiccardoElena/LASD_test'
          path: 'Esercizi/exercise1/zmytest'
          token: ${{ secrets.PAT }}

      - name: Checkout other repo into zmytest
        uses: actions/checkout@v4
        with:
          repository: 'RiccardoElena/LASD_test'
          path: 'Esercizi/exercise2/zmytest'
          token: ${{ secrets.PAT }}

      - name: Install gcc 13
        run: |
          sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test
          sudo apt-get update
          sudo apt install -y gcc-13
          g++ --version

      - name: Run Makefile
        run: ./.github/workflows/scripts/compile.sh

      - name: Execute output and check result
        run: ./.github/workflows/scripts/run.sh
